<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gomega AI — Code Generator</title>
  <!-- Prism for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#4f46e5}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071026 0%, #07182b 100%);color:#e6eef6;display:flex;align-items:flex-start;justify-content:center;padding:28px}
    .wrap{width:min(1100px,96%);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);border-radius:14px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    .controls{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    select,textarea,input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-family:inherit}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:12px;margin-top:12px}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;color:white;cursor:pointer;font-weight:600}
    button:disabled{opacity:0.5;cursor:not-allowed}
    .thinking{display:flex;gap:10px;align-items:center;color:var(--muted);margin-left:6px}
    .dots{display:inline-block}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);display:inline-block;margin-right:6px;opacity:0.3;animation:dots 1s infinite}
    .dot:nth-child(2){animation-delay:0.15s}
    .dot:nth-child(3){animation-delay:0.3s}
    @keyframes dots{0%{opacity:0.2;transform:translateY(0)}50%{opacity:1;transform:translateY(-6px)}100%{opacity:0.2;transform:translateY(0)}}
    .output{margin-top:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    pre{margin:0;max-height:520px;overflow:auto;padding:12px;border-radius:8px}
    .actions{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .small{font-size:13px;color:var(--muted)}
    .notice{margin-top:10px;color:#bde8c8;background:rgba(189,232,200,0.04);padding:8px;border-radius:8px;border:1px solid rgba(189,232,200,0.04)}
  </style>
</head>
<body>
  <div class="wrap">
    <h2 style="margin:0 0 12px 0">Gomega AI — Code generator</h2>
    <div class="controls">
      <div class="col">
        <label for="language">Language / format</label>
        <select id="language">
          <option value="html">HTML</option>
          <option value="javascript">JavaScript</option>
          <option value="python">Python</option>
          <option value="lua">Lua</option>
          <option value="css">CSS</option>
          <option value="bash">Bash</option>
          <option value="json">JSON</option>
        </select>
      </div>
      <div class="col">
        <label for="style">Style (optional)</label>
        <select id="style">
          <option value="clean">Clean / minimal</option>
          <option value="commented">Include comments</option>
          <option value="explain">Code + short explanation</option>
        </select>
      </div>
    </div>

    <div style="margin-top:12px">
      <label for="prompt">Prompt (describe what code you want)</label>
      <textarea id="prompt" placeholder="Example: A responsive navbar in HTML/CSS with a mobile menu and accessible links"></textarea>
    </div>

    <div class="row">
      <button id="generate">Generate with Gomega AI</button>
      <div class="thinking" id="thinking" style="display:none">
        <div class="dots">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
        <div class="small">Gomega AI is thinking…</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="small">Gomega AI runs locally — no API keys or external calls. Everything is generated in your browser.</div>
      </div>
    </div>

    <div class="output" id="outputArea" style="display:none">
      <div class="actions">
        <div class="small" id="meta">Output</div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button id="copyBtn">Copy</button>
          <button id="downloadBtn">Download</button>
        </div>
      </div>
      <pre><code id="codeBlock" class="language-javascript">// Gomega AI generated code will appear here</code></pre>
    </div>

    <div class="notice">
      <strong>Local AI</strong>: Gomega AI is a client-side generator that uses built-in templates and simple heuristics to convert your prompt into working starter code. It's fast and private, but for very large or highly creative code you may want to refine the prompt or combine snippets manually.
    </div>
  </div>

  <script>
    const prismMap = {
      html: 'language-markup',
      javascript: 'language-javascript',
      python: 'language-python',
      lua: 'language-lua',
      css: 'language-css',
      bash: 'language-bash',
      json: 'language-json'
    };

    const languageSelect = document.getElementById('language');
    const styleSelect = document.getElementById('style');
    const promptEl = document.getElementById('prompt');
    const generateBtn = document.getElementById('generate');
    const thinkingEl = document.getElementById('thinking');
    const outputArea = document.getElementById('outputArea');
    const codeBlock = document.getElementById('codeBlock');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const meta = document.getElementById('meta');

    // Simple local "Gomega AI" generator with pattern matching and templates
    function fallbackGenerate(lang, prompt, style) {
      const p = prompt.trim();
      const tokens = p.toLowerCase();

      // small helper to wrap in proper language structure
      const wrap = {
        html: (s) => `<!doctype html>
<html>
  <head>
    <meta charset=\"utf-8\">
    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">
    <title>Gomega AI Generated</title>
    <style>/* minimal styles */ body{font-family:sans-serif;padding:20px}
${s.includes('<nav')? '' : ''}</style>
  </head>
  <body>
${s}
  </body>
</html>` ,
        javascript: (s) => `// Gomega AI — JavaScript
// Prompt: ${p}
${s}`,
        python: (s) => `# Gomega AI — Python
# Prompt: ${p}
${s}`,
        lua: (s) => `-- Gomega AI — Lua
-- Prompt: ${p}
${s}`,
        css: (s) => `/* Gomega AI — CSS */
/* Prompt: ${p} */
${s}`,
        bash: (s) => `#!/usr/bin/env bash
# Gomega AI — Bash
# Prompt: ${p}
${s}`,
        json: (s) => `${s}`
      };

      // heuristics: detect common intents
      if (tokens.includes('navbar') || tokens.includes('navigation') || tokens.includes('menu')) {
        if (lang === 'html') {
          return wrap.html(`    <nav aria-label=\"Main navigation\">
      <button id=\"menuToggle\">Menu</button>
      <ul id=\"menu\">
        <li><a href=\"#\">Home</a></li>
        <li><a href=\"#\">About</a></li>
        <li><a href=\"#\">Contact</a></li>
      </ul>
    </nav>
    <script>document.getElementById('menuToggle').addEventListener('click',()=>document.getElementById('menu').classList.toggle('open'))</script>`);
        }
        if (lang === 'css') {
          return `/* Simple navbar styles */
nav{display:flex;align-items:center;gap:12px}
nav ul{list-style:none;display:flex;gap:8px;padding:0;margin:0}`;
        }
      }

      if (tokens.includes('todo') && lang === 'javascript') {
        return wrap.javascript(`const list = document.createElement('ul');
const input = document.createElement('input');
const button = document.createElement('button');
button.textContent = 'Add';
button.addEventListener('click', ()=>{const li=document.createElement('li');li.textContent=input.value;list.appendChild(li);input.value=''});
document.body.appendChild(input);document.body.appendChild(button);document.body.appendChild(list);`);
      }

      if (tokens.includes('fetch') && lang === 'javascript') {
        return wrap.javascript(`// Example fetch usage
fetch('https://api.example.com/data')
  .then(r=>r.json())
  .then(data=>console.log(data))
  .catch(err=>console.error(err));`);
      }

      if (tokens.includes('discord bot') && lang === 'javascript') {
        return wrap.javascript(`// Starter: simple discord.js bot (v14+) example
const {Client, GatewayIntentBits} = require('discord.js');
const client = new Client({intents: [GatewayIntentBits.Guilds]});
client.once('ready', ()=>console.log('Ready'))
client.login('YOUR_TOKEN');`);
      }

      if (tokens.includes('function') && lang === 'lua') {
        return wrap.lua(`local function example(...)
  print('Arguments:', ...)
end

example('hello')`);
      }

      // Generic templates
      const generic = {
        html: `<main>
  <h1>${escapeHtml(p)}</h1>
  <p>Starter template from Gomega AI. Edit as needed.</p>
</main>`,
        javascript: `// Prompt: ${p}
(function main(){
  console.log('Hello from Gomega AI');
})();`,
        python: `def main():
    print('Hello from Gomega AI')

if __name__ == '__main__':
    main()`,
        lua: `local function main()
  print('Hello from Gomega AI')
end

main()`,
        css: `/* Styles for prompt: ${p} */
body{font-family:Inter,system-ui;margin:0;padding:20px}`,
        bash: `echo "Gomega AI — generated script"`,
        json: `{
  "generated_for": ${JSON.stringify(p)},
  "note": "Use this JSON as a starting point"
}`
      };

      let out = generic[lang] || `// No template for ${lang}`;

      // add comments if requested
      if (style === 'commented') {
        out = (lang === 'css' || lang === 'json') ? out + '
/* End of template */' : `/* Generated by Gomega AI — commented mode */
` + out;
      } else if (style === 'explain') {
        out = (lang.startsWith('python') || lang === 'lua' || lang === 'bash') ? out + `
# Explanation: This is a simple starter for "${p}"` : `// Explanation: This is a simple starter for "${p}"
` + out;
      }

      return wrap[lang] ? wrap[lang](out) : out;
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"']/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]});
    }

    async function revealText(targetEl, text, langClass) {
      targetEl.className = langClass || '';
      targetEl.textContent = '';
      outputArea.style.display = 'block';
      meta.textContent = 'Output — rendering';
      const delay = 6; // ms per char
      for (let i = 0; i < text.length; i++) {
        targetEl.textContent += text[i];
        if (i % 80 === 0) Prism.highlightElement(targetEl);
        await new Promise(r => setTimeout(r, delay));
      }
      Prism.highlightElement(targetEl);
      meta.textContent = 'Output — done';
    }

    async function generateCode() {
      const lang = languageSelect.value;
      const style = styleSelect.value;
      const prompt = promptEl.value;

      if (!prompt.trim()) { alert('Please enter a prompt.'); return; }

      generateBtn.disabled = true;
      thinkingEl.style.display = 'flex';
      outputArea.style.display = 'none';
      codeBlock.textContent = '';

      try {
        // Always use local Gomega AI generator
        const generated = fallbackGenerate(lang, prompt, style);
        // strip any accidental triple backticks
        const clean = generated.replace(/^```[a-z]*
?|
?```$/g, '');
        await revealText(codeBlock, clean, prismMap[lang] || 'language-javascript');
      } catch (err) {
        console.error(err);
        const fallback = `// Gomega AI error: ${err.message}
` + fallbackGenerate(lang, prompt, style);
        await revealText(codeBlock, fallback, prismMap[lang] || 'language-javascript');
      } finally {
        thinkingEl.style.display = 'none';
        generateBtn.disabled = false;
      }
    }

    generateBtn.addEventListener('click', generateCode);

    copyBtn.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(codeBlock.textContent); copyBtn.textContent = 'Copied!'; setTimeout(()=>copyBtn.textContent='Copy',1200); }
      catch (e) { alert('Copy failed: ' + e.message); }
    });

    downloadBtn.addEventListener('click', () => {
      const lang = languageSelect.value;
      const extMap = {html:'html', javascript:'js', python:'py', lua:'lua', css:'css', bash:'sh', json:'json'};
      const ext = extMap[lang] || 'txt';
      const filename = `gomega_ai_generated.${ext}`;
      const blob = new Blob([codeBlock.textContent], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    window.addEventListener('keydown', (e) => { if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') generateCode(); });
  </script>
</body>
</html>
