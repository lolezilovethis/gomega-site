<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gomega Watch — Music</title>
  <meta name="description" content="Music — embed Spotify playlists, albums and tracks" />
  <style>
    :root{
      --bg:#0f1720;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#1db954; /* spotify green */
      --glass: rgba(255,255,255,0.03);
      font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#07101a);color:#e6eef6}
    .wrap{max-width:980px;margin:36px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{
      width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#22303a,#0e1418);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);box-shadow:0 6px 18px rgba(0,0,0,.5)
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .card{background:var(--card);border-radius:12px;padding:18px;margin-top:16px;box-shadow:0 6px 18px rgba(0,0,0,.45)}
    .controls{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:14px;align-items:center}
    .input{
      display:flex;gap:8px;align-items:center;flex:1;
      background:var(--glass);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)
    }
    input[type="text"]{flex:1;background:transparent;border:none;color:inherit;outline:none;font-size:14px;padding:6px}
    button, .btn {
      background:var(--accent);color:#061013;border:none;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;
      box-shadow:0 6px 12px rgba(29,185,84,0.12)
    }
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);box-shadow:none}
    .iframe-wrap{position:relative;padding-top:56.25%;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    .meta-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px;gap:12px}
    .meta-left{display:flex;gap:12px;align-items:center}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:12px;color:var(--muted)}
    .notice{margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted);font-size:13px}
    @media (max-width:560px){.controls{flex-direction:column;align-items:stretch}.meta-row{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">GM</div>
      <div>
        <h1>Music</h1>
        <p class="lead">Embed Spotify playlists, albums, or tracks. Paste a Spotify URL/ID below or use the default playlist.</p>
      </div>
    </header>

    <div class="card" role="region" aria-label="Spotify embed card">
      <div class="controls">
        <div class="input" title="Paste a Spotify link or ID (playlist/album/track)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.9" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2z" fill="#1db954"/><path d="M8 9.5c3.2-1.9 6.8-1.9 9 0 .2.12.3.33.25.54-.06.22-.27.38-.5.38H7.05c-.23 0-.44-.16-.5-.38-.06-.21.06-.43.25-.54z" fill="#061013" opacity=".9"/></svg>
          <input id="q" type="text" placeholder="Spotify URL, spotify:playlist:ID, or just a playlist ID" aria-label="Spotify URL or ID" />
          <button id="load" class="btn" title="Load embed">Load</button>
        </div>

        <button id="openSpotify" class="ghost" title="Open in Spotify web player">Open in Spotify</button>
        <button id="downloadBat" class="ghost" title="Download Windows launcher that opens Chrome with a custom user-agent">Download Chrome-launcher (.bat)</button>
      </div>

      <div id="iframeContainer" class="iframe-wrap" aria-live="polite">
        <!-- iframe will be injected here -->
      </div>

      <div class="meta-row">
        <div class="meta-left">
          <div class="small">Embedded from Spotify</div>
          <div class="muted" id="embedInfo">No playlist loaded</div>
        </div>
        <div>
          <a id="rawOpen" class="small" href="#" target="_blank" rel="noopener">Open in Spotify App / Web</a>
        </div>
      </div>

      <div class="notice" id="note">
        Tip: If you want to open this page using a custom Chrome user-agent on Windows, use the "Download Chrome-launcher" button and run the `.bat` locally. A website cannot change other visitors' browser flags or user-agent.
      </div>
    </div>
  </div>

<script>
(function(){
  const defaultSpotify = "https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M"; // default embed (change as you like)
  const uaString = 'mozilla/5.0 (X11; CrOS aarch64 13099.85.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.110 Safari/537.36 - Google Search';
  const chromeExePath = 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe';

  const qInput = document.getElementById('q');
  const loadBtn = document.getElementById('load');
  const iframeContainer = document.getElementById('iframeContainer');
  const embedInfo = document.getElementById('embedInfo');
  const openSpotify = document.getElementById('openSpotify');
  const rawOpen = document.getElementById('rawOpen');
  const downloadBat = document.getElementById('downloadBat');

  function createIframe(embedUrl){
    iframeContainer.innerHTML = '';
    const iframe = document.createElement('iframe');
    iframe.src = embedUrl;
    iframe.allow = 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture';
    iframe.setAttribute('referrerpolicy','no-referrer');
    iframe.title = 'Spotify embed';
    iframeContainer.appendChild(iframe);
  }

  function sanitize(val){
    return String(val).trim();
  }

  function toEmbed(input){
    // Accept many formats:
    // - https://open.spotify.com/playlist/{id}
    // - spotify:playlist:{id}
    // - full embed URL
    // - bare ID (length 22 typical)
    if(!input) return defaultSpotify;
    input = sanitize(input);

    // already an embed
    if(input.includes('open.spotify.com/embed')) {
      return input;
    }

    // if full open.spotify.com url
    const openMatch = input.match(/open\.spotify\.com\/(playlist|album|track)\/([A-Za-z0-9]+)(?:\?|$)/i);
    if(openMatch){
      return `https://open.spotify.com/embed/${openMatch[1]}/${openMatch[2]}`;
    }

    // spotify:... format
    const colonMatch = input.match(/^spotify:(playlist|album|track):([A-Za-z0-9]+)$/i);
    if(colonMatch){
      return `https://open.spotify.com/embed/${colonMatch[1]}/${colonMatch[2]}`;
    }

    // maybe the user pasted a short ID (22+ chars) - assume playlist
    if(/^[A-Za-z0-9]{8,}$/i.test(input)){
      // best-effort: treat as playlist
      return `https://open.spotify.com/embed/playlist/${input}`;
    }

    // fallback
    return defaultSpotify;
  }

  function setLinksForEmbed(embedUrl){
    // Convert embed URL to normal open.spotify.com link for "Open in Spotify"
    const match = embedUrl.match(/embed\/(playlist|album|track)\/([A-Za-z0-9]+)/i);
    if(match){
      const type = match[1];
      const id = match[2];
      const openUrl = `https://open.spotify.com/${type}/${id}`;
      openSpotify.onclick = ()=> window.open(openUrl,'_blank','noopener');
      rawOpen.href = openUrl;
      embedInfo.textContent = `${type} • ${id}`;
    } else {
      openSpotify.onclick = ()=> window.open('https://open.spotify.com','_blank','noopener');
      rawOpen.href = 'https://open.spotify.com';
      embedInfo.textContent = 'Spotify';
    }
  }

  function loadFromQuery(){
    const urlParams = new URLSearchParams(window.location.search);
    const q = urlParams.get('q') || urlParams.get('playlist') || urlParams.get('id') || '';
    const embed = toEmbed(q);
    createIframe(embed);
    setLinksForEmbed(embed);
    qInput.value = q || '';
  }

  loadBtn.addEventListener('click', ()=>{
    const val = qInput.value;
    const embed = toEmbed(val);
    createIframe(embed);
    setLinksForEmbed(embed);
    // update URL without reloading
    const newUrl = new URL(window.location.href);
    if(val) newUrl.searchParams.set('q', val);
    else newUrl.searchParams.delete('q');
    history.replaceState({}, '', newUrl);
  });

  // Create .bat file with proper quoting and start command
  downloadBat.addEventListener('click', ()=>{
    const urlParams = new URLSearchParams(window.location.search);
    const currentQ = qInput.value || urlParams.get('q') || '';
    const safeUrl = (function(){
      // build the page URL to open in chrome (absolute)
      const pageUrl = new URL(window.location.href);
      if(currentQ) pageUrl.searchParams.set('q', currentQ);
      else pageUrl.searchParams.delete('q');
      return pageUrl.toString();
    })();

    // BAT content - using start to avoid blocking console; wrap UA in double quotes
    const bat = `@echo off\r\n` +
                `REM Chrome launcher for Gomega Watch Music (runs Chrome with custom user-agent)\r\n` +
                `start "" "${chromeExePath}" --user-agent="${uaString}" "${safeUrl}"\r\n`;

    const blob = new Blob([bat], {type: 'application/x-msdownload'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'gomega-chrome-launcher.bat';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=> URL.revokeObjectURL(url), 10000);
  });

  // initial load: use ?q=...
  loadFromQuery();

  // nice small UX: pressing Enter in input triggers load
  qInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ loadBtn.click(); } });
})();
</script>
</body>
</html>
