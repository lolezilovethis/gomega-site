<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scripts ‚Äì Gomega Watch</title>

  <!-- AdSense Auto Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2566003301154558" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; background: white; color: black; transition: background 0.3s, color 0.3s; }
    .dark-mode { background: #121212; color: white; }
    .script-card { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 10px; background: #f9f9f9; }
    .dark-mode .script-card { background: #1f1f1f; border-color: #333; }
    .search-box { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ccc; }
    button { background-color: #3b82f6; color: white; padding: 10px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
    button:hover { opacity: 0.9; }
    pre { background: #f2f2f2; padding: 10px; border-radius: 8px; white-space: pre-wrap; font-family: monospace; }
    .dark-mode pre { background: #2a2a2a; }
    .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
    .logo img { height: 40px; }
    footer { margin-top: 40px; text-align: center; font-size: 14px; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .info { font-size: 0.9rem; margin-top: 4px; }
    @media (max-width: 600px) { .script-card { padding: 10px; } button { width: 100%; } }
    #hoverParticles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
  </style>
</head>
<body>

  <!-- Auth Redirect -->
  <script type="module">
    import { auth } from './js/firebase.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
    onAuthStateChanged(auth, user => { if (!user) location.href = '/'; });
  </script>

  <!-- Third-Party Ad Provider -->
  <script async src="https://a.magsrv.com/ad-provider.js"></script>
  <ins class="eas6a97888e2" data-zoneid="5672278"></ins>
  <script> (AdProvider = window.AdProvider||[]).push({serve:{}}); </script>

  <div class="top-bar">
    <div class="logo">
      <img src="assets/logo.png" alt="Gomega Watch Logo">
      <h1>Gomega Scripts</h1>
    </div>
    <div style="display:flex; gap:10px;">
      <button id="darkToggle">üåì Dark Mode</button>
      <button id="settingsBtn">‚öôÔ∏è Settings</button>
      <button id="makeScriptBtn">‚úèÔ∏è Make a Script</button>
    </div>
  </div>

  <input class="search-box" id="searchBox" placeholder="Search scripts‚Ä¶">
  <p id="scriptCount"></p>
  <div id="scriptList"><p>üîÑ Loading scripts...</p></div>

  <footer>
    <a href="https://discord.gg/kZtW4y2Q7u" target="_blank">üí¨ Join our Discord</a>
  </footer>

  <canvas id="hoverParticles"></canvas>

  <script type="module">
    import { db } from './js/firebase.js';
    import { collection, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    let allLocal = [];
    let allRemote = [];

    async function loadLocal() {
      try {
        const res = await fetch('scripts/index.json');
        const files = await res.json();
        allLocal = await Promise.all(files.map(name => fetch(`scripts/${name}`).then(r => r.json())));
        mergeAndRender();
      } catch (e) {
        console.error('Local load error', e);
      }
    }

    function loadRemote() {
      const col = collection(db, 'approved_scripts');
      onSnapshot(col, snap => {
        allRemote = snap.docs.map(d => d.data());
        mergeAndRender();
      }, err => console.error('Remote load error', err));
    }

    function mergeAndRender() {
      const merged = [...allRemote, ...allLocal];
      renderScripts(merged);
    }

    function renderScripts(scripts) {
      const list = document.getElementById('scriptList');
      const count = document.getElementById('scriptCount');
      list.innerHTML = '';
      scripts.forEach(script => {
        const id = script.title.toLowerCase().replace(/\s+/g, '-');
        const adsInfo = script.includeAds ? `${script.numAds} ad${script.numAds > 1 ? 's' : ''}` : 'No ads';
        const publisher = script.brandName || 'Admin';
        list.insertAdjacentHTML('beforeend', `
          <div class="script-card">
            <h2>${script.title}</h2>
            <p>${script.description || 'No description.'}</p>
            <p class="info"><strong>Publisher:</strong> ${publisher}</p>
            <p class="info"><strong>Ads:</strong> ${adsInfo}</p>
            ${script.getPaid ? `<p class="info">üí∞ Publisher will earn revenue</p>` : ''}
            <button class="get-btn" data-id="${id}">üì• Get Script</button>
            <button class="copy-btn" data-id="${id}" style="display:none;">üìã Copy Script</button>
            <pre id="code-${id}" style="display:none;"></pre>
          </div>
        `);
      });
      count.textContent = `Total Scripts: ${scripts.length}`;
      attachUnlockHandlers();
    }

    function attachUnlockHandlers() {
      document.querySelectorAll('.get-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const script = [...allRemote, ...allLocal].find(s => s.title.toLowerCase().replace(/\s+/g, '-') === id);
          const box = document.getElementById(`code-${id}`);
          const copyBtn = document.querySelector(`.copy-btn[data-id="${id}"]`);

          if (script.includeAds && script.numAds > 0) {
            if (!confirm(`You must view ${script.numAds} ad${script.numAds > 1 ? 's' : ''}.`)) return;
            let openedAds = 0;
            while (openedAds < script.numAds) {
              window.open('https://hidcolouredclink.com/ru3zsuaiqq?key=71cc264ea7a7deaffc057c222bc73431', '_blank');
              openedAds++;
              await new Promise(r => setTimeout(r, 1500));
            }
          }

          box.style.display = 'block';
          box.textContent = script.code;
          copyBtn.style.display = 'inline-block';

          try {
            await navigator.clipboard.writeText(script.code);
            alert('‚úÖ Copied!');
          } catch {
            alert('‚ö†Ô∏è Copy failed. Use the "Copy Script" button.');
          }
        };
      });

      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          const code = document.getElementById(`code-${id}`).textContent;
          navigator.clipboard.writeText(code).then(() => {
            alert('‚úÖ Script copied!');
          }).catch(() => {
            alert('‚ö†Ô∏è Could not copy script.');
          });
        };
      });
    }

    document.getElementById('searchBox').addEventListener('input', e => {
      const term = e.target.value.toLowerCase();
      const merged = [...allRemote, ...allLocal];
      renderScripts(merged.filter(s =>
        s.title.toLowerCase().includes(term) ||
        (s.description && s.description.toLowerCase().includes(term))
      ));
    });

    document.getElementById('darkToggle').onclick = () => document.body.classList.toggle('dark-mode');
    document.getElementById('settingsBtn').onclick = () => location.href = 'settings';
    document.getElementById('makeScriptBtn').onclick = () => location.href = 'add-script.html';

    loadLocal();
    loadRemote();
  </script>

  <script>
    const canvas = document.getElementById('hoverParticles'), ctx = canvas.getContext('2d'); let particles = [];
    function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
    window.addEventListener('resize', resize); resize();
    document.addEventListener('mousemove', e => { for (let i = 0; i < 3; i++) particles.push({ x: e.clientX, y: e.clientY, r: Math.random() * 2 + 1, vx: Math.random() * 2 - 1, vy: Math.random() * 2 - 1, life: 60 }); });
    (function draw() { ctx.clearRect(0, 0, canvas.width, canvas.height); particles = particles.filter(p => p.life > 0); particles.forEach(p => { p.x += p.vx; p.y += p.vy; p.life--; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI); ctx.fillStyle = `rgba(0,217,255,${p.life/60})`; ctx.fill(); }); requestAnimationFrame(draw); })();
  </script>

</body>
</html>
