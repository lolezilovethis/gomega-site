<!-- Save as: search.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gomega Search (Google)</title>
<style>
  html,body{height:100%;margin:0;font-family:Segoe UI,Roboto,Arial;background:#fff;color:#202124}
  .center{display:flex;flex-direction:column;align-items:center;padding:36px}
  .logo{font-size:72px;font-weight:700;margin:40px 0}
  .logo .g{color:#4285F4}.logo .o{color:#DB4437}.logo .m{color:#F4B400}.logo .e{color:#4285F4}.logo .t{color:#0F9D58}.logo .a{color:#DB4437}
  .search-row{width:90%;max-width:960px;display:flex;gap:8px;align-items:center}
  .search-input{flex:1;padding:12px 14px;border-radius:28px;border:1px solid #dfe1e5;font-size:18px;outline:none}
  .btn{padding:10px 14px;border-radius:8px;border:0;background:#1a73e8;color:#fff;cursor:pointer;font-size:15px}
  #webwrap{width:100%;height:calc(100vh - 250px);margin-top:18px;display:none}
  iframe#results{width:100%;height:100%;border:0}
  .status{margin-left:12px;color:#5f6368;font-size:14px}
</style>
</head>
<body>
  <div class="center">
    <div class="logo"><span class="g">G</span><span class="o">o</span><span class="m">m</span><span class="e">e</span><span class="t">t</span><span class="a">a</span></div>

    <div class="search-row" role="search">
      <input id="q" class="search-input" type="text" placeholder="Search Google via Gomega" aria-label="Search query" />
      <button id="btnSearch" class="btn">Gomega Search</button>
      <div id="status" class="status">Ready</div>
    </div>

    <div id="webwrap"><iframe id="results" sandbox="allow-forms allow-same-origin allow-scripts"></iframe></div>
  </div>

<script>
/*
 Behavior:
  - When the user searches, client calls /api/google-proxy?q=... on the same origin.
  - The server returns raw HTML from Google (or an error). The client writes that HTML to the iframe via srcdoc.
  - If proxy is not present, we gracefully open Google in new tab with normal UA.
*/
const input = document.getElementById('q');
const btn = document.getElementById('btnSearch');
const status = document.getElementById('status');
const webwrap = document.getElementById('webwrap');
const resultsFrame = document.getElementById('results');

function setStatus(s){ status.textContent = s; }

async function doSearch(){
  const q = input.value.trim();
  if(!q){ setStatus('Type a query'); return; }
  setStatus('Searching via proxy...');
  const url = '/api/google-proxy?q=' + encodeURIComponent(q);
  try {
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok){
      setStatus('Proxy error: ' + res.statusText + ' — opening Google directly');
      // fallback open in new tab to give immediate results
      window.open('https://www.google.com/search?q=' + encodeURIComponent(q), '_blank');
      return;
    }
    const text = await res.text();

    // Render returned HTML into iframe using srcdoc to keep it sandboxed.
    webwrap.style.display = 'block';
    // Some Google HTML contains <meta http-equiv="Content-Security-Policy"...> which can prevent script execution in srcdoc.
    // We display it as-is (this usually renders search results). If it fails, user can open in new tab (fallback).
    resultsFrame.srcdoc = text;
    setStatus('Results loaded');
  } catch (err) {
    console.error(err);
    setStatus('Network error — opening Google directly');
    window.open('https://www.google.com/search?q=' + encodeURIComponent(q), '_blank');
  }
}

btn.addEventListener('click', doSearch);
input.addEventListener('keydown', e => { if(e.key === 'Enter') doSearch(); });

// optionally prefill from ?q= on page load
(function init(){
  const params = new URLSearchParams(location.search);
  const q = params.get('q') || '';
  if(q){ input.value = q; doSearch(); }
})();
</script>
</body>
</html>
