<!-- Save as search.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gomega Search</title>
<link rel="icon" href="/favicon.ico" />
<style>
  :root{
    --bg:#ffffff; --muted:#5f6368; --accent:#1a73e8; --card:#fff;
    --card-border:#e6e6e6; --radius:10px; --gap:14px; font-family: "Segoe UI", Roboto, Arial, sans-serif;
  }
  html,body{height:100%; margin:0; background:var(--bg); color:#202124}
  .page{min-height:100%; display:flex; flex-direction:column; align-items:center;}
  header{width:100%; padding:18px 36px; box-sizing:border-box;}
  .top-links{display:flex; justify-content:flex-end; gap:18px; font-size:13px; color:var(--muted)}
  .logo{margin:54px 0 6px; font-size:72px; font-weight:700; letter-spacing:-2px; text-align:center;}
  .logo .g{color:#4285F4}.logo .o{color:#DB4437}.logo .m{color:#F4B400}.logo .e{color:#4285F4}.logo .t{color:#0F9D58}.logo .a{color:#DB4437}
  .search-wrap{width:100%; display:flex; justify-content:center; margin-bottom:14px;}
  .search-box{width:760px; max-width:94%; background:var(--card); border:1px solid var(--card-border); box-shadow:0 1px 6px rgba(32,33,36,0.06); border-radius:28px; display:flex; align-items:center; padding:10px 14px;}
  .search-box input{flex:1; border:0; outline:none; font-size:18px; padding:8px 12px}
  .search-box button{border:0; background:transparent; cursor:pointer; font-size:18px; padding:8px}
  .search-actions{margin-top:10px; display:flex; gap:10px; justify-content:center}
  .btn{background:#f8f9fa; border:1px solid #e8e8e8; padding:9px 16px; border-radius:6px; cursor:pointer; color:#3c4043}
  .btn.primary{background:var(--accent); color:#fff; border-color:var(--accent)}
  .results-container{width:86%; max-width:1100px; margin:18px auto 120px; display:block}
  .meta{color:var(--muted); font-size:14px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center}
  .result{background:var(--card); border:1px solid var(--card-border); border-radius:10px; padding:12px; margin-bottom:12px; display:flex; gap:12px; align-items:flex-start}
  .result .thumb{width:96px; height:64px; background:#f1f3f4; border-radius:6px; flex:0 0 96px; display:flex; align-items:center; justify-content:center; color:var(--muted); font-size:12px}
  .result .content{flex:1}
  .result .title{font-size:18px; color:#1a0dab; text-decoration:none}
  .result .url{font-size:13px; color:#006621; margin-top:6px}
  .result .snippet{margin-top:8px; color:#4d4d4d; font-size:14px}
  .tags{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap}
  .tag{background:#f1f3f4; padding:6px 8px; border-radius:999px; font-size:12px; color:#5f6368}
  .highlight{background: #fff176; padding:0 2px}
  .pager{display:flex; gap:6px; justify-content:center; margin-top:14px}
  .pager button{padding:6px 10px; border-radius:6px; border:1px solid #e5e5e5; background:#fff; cursor:pointer}
  footer{position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid #eee; padding:12px 24px; display:flex; justify-content:space-between; font-size:13px; color:var(--muted)}
  .empty{padding:32px; text-align:center; color:var(--muted)}
  @media (max-width:640px){ .logo{font-size:44px} .search-box{border-radius:20px} .search-wrap{padding:0 12px}}
</style>
</head>
<body>
  <div class="page">
    <header>
      <div class="top-links">
        <a href="/about">About</a>
        <a href="/store">Store</a>
      </div>
    </header>

    <div class="logo"><span class="g">G</span><span class="o">o</span><span class="m">m</span><span class="e">e</span><span class="t">t</span><span class="a">a</span></div>

    <div class="search-wrap" role="search" aria-label="Search Gomega">
      <div style="width:100%; text-align:center">
        <div class="search-box" role="search">
          <button id="btnIcon" title="Search">üîç</button>
          <input id="q" type="text" placeholder="Search Gomega" aria-label="Search query" />
          <div style="margin-left:12px">
            <button id="btnGo" class="btn primary">Gomega Search</button>
          </div>
        </div>

        <div class="search-actions" style="margin-top:12px;">
          <div style="color:var(--muted); font-size:13px">Tip: press Enter to search</div>
        </div>
      </div>
    </div>

    <div class="results-container" id="resultsContainer" aria-live="polite">
      <!-- meta and results inserted here -->
    </div>

    <footer>
      <div>Gomega &copy; <span id="yr"></span></div>
      <div>
        <a href="/privacy">Privacy</a> &nbsp;‚Ä¢&nbsp; <a href="/terms">Terms</a>
      </div>
    </footer>
  </div>

<script>
/* search.html
   - Drops straight into your site as "search.html".
   - Reads ?q=...; if no q shows empty state.
   - Built-in demo dataset (replace or expand).
   - If server endpoint /api/search?q= exists and returns JSON array of same items, it will use that instead.
   - Result item schema: {id,title,url,snippet,tags,image}
*/

// ---------- configuration ----------
const SEARCH_API = '/api/search?q='; // if you add server search, page will try this first (must return JSON array)
const CLIENT_DATA = [
  { id:1, title:"Gomega Home", url:"/index.html", snippet:"Welcome to Gomega ‚Äî home of school-friendly games, scripts, and tools.", tags:["home","welcome"], image:"/images/home-thumb.png" },
  { id:2, title:"School Games", url:"/schoolgames", snippet:"A curated collection of safe, school-friendly web games you can play at school.", tags:["games","school"], image:"/images/games-thumb.png" },
  { id:3, title:"Scripts Library", url:"/scripts", snippet:"Browse free Roblox scripts, utilities, and admin tools available for download.", tags:["scripts","roblox"], image:"/images/scripts-thumb.png" },
  { id:4, title:"Gomega AI", url:"/ai", snippet:"Chat with Gomega AI for homework help, coding tips, and quick answers.", tags:["ai","chat"], image:"/images/ai-thumb.png" },
  { id:5, title:"Create Account", url:"/signup.html", snippet:"Create a Gomega account to save favorites, comments, and uploads.", tags:["auth","accounts"], image:"/images/account-thumb.png" },
  { id:6, title:"Background Checks", url:"/background.html", snippet:"Search usernames across platforms to gather public profile info for safety checks.", tags:["safety","background"], image:"/images/bg-thumb.png" },
  { id:7, title:"Admin Panel", url:"/admin", snippet:"Admin-only tools: ban/unban users, remove scripts, and moderate uploads.", tags:["admin","moderation"], image:"/images/admin-thumb.png" },
  { id:8, title:"Gomega Store", url:"/store", snippet:"Support Gomega by buying premium themes, badges, and hosting credits.", tags:["store","payments"], image:"/images/store-thumb.png" }
];
const PAGE_SIZE = 6;

// ---------- helpers ----------
function qs(name){ // read ?q param
  const params = new URLSearchParams(location.search);
  return params.get(name) || '';
}
function encodeQuery(q){ return encodeURIComponent(q); }
function sanitizeHtml(s){
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function highlight(text, q){
  if(!q) return sanitizeHtml(text);
  const safeQ = q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
  const re = new RegExp(safeQ,'ig');
  return sanitizeHtml(text).replace(re, m => `<span class="highlight">${m}</span>`);
}

// ---------- scoring search ----------
function scoreItem(item, q){
  if(!q) return 0;
  q = q.toLowerCase();
  let score = 0;
  if(item.title && item.title.toLowerCase().includes(q)) score += 30;
  if(item.snippet && item.snippet.toLowerCase().includes(q)) score += 12;
  if(item.tags && item.tags.join(' ').toLowerCase().includes(q)) score += 6;
  // small boost for URL match
  if(item.url && item.url.toLowerCase().includes(q)) score += 3;
  return score;
}

// ---------- render ----------
const container = document.getElementById('resultsContainer');
const input = document.getElementById('q');
const btnGo = document.getElementById('btnGo');
const btnIcon = document.getElementById('btnIcon');
const yr = document.getElementById('yr'); yr.textContent = new Date().getFullYear();

// attempt server search first; fallback to client search
async function searchAndRender(q, page=1){
  container.innerHTML = ''; // clear
  if(!q){
    container.innerHTML = `<div class="empty"><strong>Search Gomega</strong><div style="margin-top:8px;color:var(--muted)">Type something above and press Enter or click Gomega Search</div></div>`;
    return;
  }

  // meta area
  const meta = document.createElement('div'); meta.className = 'meta';
  meta.innerHTML = `<div>Results for <strong>${sanitizeHtml(q)}</strong></div><div id="metaRight" style="color:var(--muted)"></div>`;
  container.appendChild(meta);

  // try server
  let results = [];
  let usedServer = false;
  try{
    const resp = await fetch(SEARCH_API + encodeQuery(q), {cache:'no-store'});
    if(resp.ok){
      const arr = await resp.json();
      if(Array.isArray(arr)){
        results = arr;
        usedServer = true;
      }
    }
  }catch(e){
    // network or no API ‚Äî fall back to client dataset
  }

  if(!usedServer){
    // client-side search: score & sort
    results = CLIENT_DATA.map(it => {
      return { ...it, _score: scoreItem(it,q) };
    }).filter(it => it._score > 0)
      .sort((a,b) => b._score - a._score);
    // if no results, attempt fuzzy includes across fields
    if(results.length === 0){
      const ql = q.toLowerCase();
      results = CLIENT_DATA.filter(it => {
        return (it.title && it.title.toLowerCase().includes(ql)) ||
               (it.snippet && it.snippet.toLowerCase().includes(ql)) ||
               (it.tags && it.tags.join(' ').toLowerCase().includes(ql));
      }).map(it => ({...it, _score:1}));
    }
  }

  // show count
  const right = document.getElementById('metaRight');
  right.textContent = `${results.length} result${results.length!==1?'s':''}`;

  if(results.length === 0){
    container.insertAdjacentHTML('beforeend', `<div class="empty">No results found for <strong>${sanitizeHtml(q)}</strong></div>`);
    return;
  }

  // pagination
  const total = results.length;
  const pages = Math.ceil(total / PAGE_SIZE);
  page = Math.max(1, Math.min(page, pages));
  const start = (page-1)*PAGE_SIZE;
  const pageItems = results.slice(start, start+PAGE_SIZE);

  // render items
  pageItems.forEach(it => {
    const div = document.createElement('div'); div.className = 'result';
    const thumb = `<div class="thumb">${it.image? '<img src="'+sanitizeHtml(it.image)+'" alt="" style="max-width:86px;max-height:60px;border-radius:6px"/>' : 'G'}</div>`;
    const safeTitle = highlight(it.title || it.url, q);
    const safeSnippet = highlight(it.snippet || '', q);
    const url = sanitizeHtml(it.url);
    div.innerHTML = `${thumb}<div class="content"><a class="title" href="${url}">${safeTitle}</a><div class="url">${url}</div><div class="snippet">${safeSnippet}</div>${renderTags(it.tags)}</div>`;
    container.appendChild(div);
  });

  // pager
  if(pages > 1){
    const pager = document.createElement('div'); pager.className = 'pager';
    for(let p=1;p<=pages;p++){
      const btn = document.createElement('button');
      btn.textContent = p;
      if(p===page){ btn.style.fontWeight='700'; btn.disabled=true; }
      btn.addEventListener('click', ()=> searchAndRender(q, p));
      pager.appendChild(btn);
    }
    container.appendChild(pager);
  }
}

function renderTags(tags){
  if(!tags || !tags.length) return '';
  const html = tags.map(t => `<span class="tag">${sanitizeHtml(t)}</span>`).join('');
  return `<div class="tags">${html}</div>`;
}

// wire UI
btnGo.addEventListener('click', ()=> {
  const q = input.value.trim();
  const url = '/search.html?q=' + encodeQuery(q);
  history.replaceState(null,'',url);
  searchAndRender(q);
});
btnIcon.addEventListener('click', ()=> btnGo.click());
input.addEventListener('keydown', (e)=> { if(e.key === 'Enter'){ btnGo.click(); } });

// on load: populate q from URL and run search if present
(function init(){
  const q0 = new URLSearchParams(location.search).get('q') || '';
  input.value = q0;
  if(q0) searchAndRender(q0);
})();
</script>
</body>
</html>
