<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Submit a Claim</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <script type="module" src="/firebase-init.js"></script>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }
    form {
      background-color: #222;
      padding: 1.5rem;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    input, select, textarea, button {
      padding: 0.75rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    button {
      background-color: #4fc3f7;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    #message {
      margin-top: 1rem;
    }
    @media (max-width: 600px) {
      .container {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìù Submit a Claim</h2>
    <form id="claimForm">
      <label>Platform
        <select id="platform" required>
          <option value="">Select platform</option>
          <option value="Google">Google</option>
          <option value="Microsoft">Microsoft</option>
          <option value="Canvas">Canvas</option>
          <option value="Roblox">Roblox</option>
        </select>
      </label>
      <label>Description
        <textarea id="description" required></textarea>
      </label>
      <label>Previous Account Info
        <input type="text" id="previousInfo" required />
      </label>
      <label>Attacker Info (if known)
        <input type="text" id="attackerInfo" />
      </label>
      <button type="submit">Submit Claim</button>
    </form>
    <div id="message"></div>
  </div>

  <script type="module">
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  import {
    getAuth,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
  import { app } from "./firebase-init.js";

  const db = getFirestore(app);
  const auth = getAuth();

  const form = document.getElementById("claimForm");
  const submitStatus = document.getElementById("submitStatus");

  onAuthStateChanged(auth, (user) => {
    if (!user) {
      form.innerHTML = "<p>You must be signed in to submit a claim.</p>";
      return;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const platform = form.platform.value;
      const description = form.description.value;
      const previousInfo = form.previousAccount.value;
      const attacker = form.attackerInfo.value;

      try {
        const docRef = await addDoc(collection(db, "claims"), {
          uid: user.uid,
          email: user.email,
          platform,
          description,
          previousInfo,
          attacker,
          status: "pending",
          timestamp: serverTimestamp()
        });

        const claimId = docRef.id;
        const claimUrl = `https://yourdomain.com/claim.html?id=${claimId}`;
        const processBase = `https://yourdomain.com/process.html?id=${claimId}&action=`;

        // ‚úÖ Send to Discord webhook
        await fetch("https://discord.com/api/webhooks/1398060748093128765/HhvxXPIdCMeyqbR6bsSyCcWPSRwkRaAkJHAdhRTyfY5Hw_NZvrh6JkYRr9lr7z4PeUD3", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            username: "Gomega Claims Bot",
            embeds: [{
              title: "üì• New Claim Submitted",
              color: 3447003,
              description: `**Platform:** ${platform}\n**Description:** ${description}\n**Previous Info:** ${previousInfo}\n**Attacker Info:** ${attacker}\n**Email:** ${user.email}`,
              footer: {
                text: `Claim ID: ${claimId}`
              },
              timestamp: new Date().toISOString()
            }],
            components: [{
              type: 1,
              components: [
                {
                  type: 2,
                  label: "‚úÖ Approve",
                  style: 3,
                  url: processBase + "approve"
                },
                {
                  type: 2,
                  label: "‚ùå Reject",
                  style: 4,
                  url: processBase + "reject"
                }
              ]
            }]
          })
        });

        form.reset();
        submitStatus.innerHTML = `‚úÖ Claim submitted. <a href="claim.html?id=${claimId}">View your request here.</a>`;
      } catch (err) {
        console.error("Error submitting claim:", err);
        submitStatus.textContent = "‚ùå Failed to submit claim. Please try again later.";
      }
    });
  });
</script>
</body>
</html>
