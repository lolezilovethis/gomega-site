<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Gomega Browser — v14.9.9</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#3ea6ff;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6eef8;background:linear-gradient(180deg,#071028 0%, #07182a 60%);}
    .app {
      max-width:1100px;margin:28px auto;padding:18px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      box-shadow: 0 8px 30px rgba(3,10,20,0.6);
      border: 1px solid rgba(255,255,255,0.02);
    }
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7fffd4);
      display:flex;align-items:center;justify-content:center;font-weight:800;color:#032034;font-size:20px;box-shadow:0 6px 18px rgba(62,166,255,0.12);
    }
    h1{font-size:18px;margin:0}
    .meta{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    .search {
      margin-top:18px;background:var(--glass);border-radius:12px;padding:18px;display:flex;gap:12px;align-items:center;
      border:1px solid rgba(255,255,255,0.03);
    }
    .search input{
      flex:1;background:transparent;border:0;outline:none;color:#e6eef8;font-size:16px;padding:14px 8px;
    }
    .btn{
      background:linear-gradient(180deg,var(--accent),#2fa1ff);border:0;padding:10px 14px;border-radius:10px;color:#032034;font-weight:700;cursor:pointer;
    }
    .sandbox {
      margin-top:18px;border-radius:12px;overflow:hidden;background:var(--card);height:640px;border:1px solid rgba(255,255,255,0.02);
      display:flex;flex-direction:column;
    }
    .toolbar{display:flex;align-items:center;gap:10px;padding:8px 12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));}
    .toolbar .path{flex:1;color:var(--muted);font-size:13px}
    .content {flex:1; display:block}
    .message{padding:28px;color:var(--muted);font-size:15px}
    .warningOverlay{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,12,0.6);
    }
    .modal{background:#071827;padding:20px;border-radius:12px;max-width:680px;color:#dff;box-shadow:0 10px 40px rgba(2,8,20,0.7)}
    .modal h3{margin:0 0 10px 0}
    .modal p{color:var(--muted);margin:0 0 16px 0}
    .modal .actions{display:flex;gap:8px;justify-content:flex-end}
    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:12px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
    a.link{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Gomega Browser">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">G</div>
        <div>
          <h1>Gomega Browser</h1>
          <div class="meta">Lightweight shell — version <strong id="ver">14.9.9</strong></div>
        </div>
      </div>
      <div class="controls">
        <button id="simOut" class="btn" title="Simulate an update prompt (developer)">Simulate Outdated</button>
        <a class="link" href="https://gomega.watch" target="_blank">gomega.watch</a>
      </div>
    </header>

    <div class="search" role="search" aria-label="Search Gomega">
      <input id="q" type="search" placeholder="Gomega Search — search gomega.watch or type a URL (ex: gomega.watch/scripts)" />
      <button id="go" class="btn">Search</button>
    </div>

    <div class="sandbox" aria-live="polite">
      <div class="toolbar">
        <div class="path" id="pathBar">Home</div>
        <div class="small">Only Gomega content is allowed inside the app. External links are blocked by default.</div>
      </div>

      <div class="content" id="content">
        <div class="message">
          <h2>Welcome to Gomega Browser</h2>
          <p class="small">Use the search box above to search the site or type a URL. When packaged as an app (Electron), this app prevents external navigation (so users can't escape to Google directly).</p>
          <p style="margin-top:12px"><strong>Tip:</strong> Try: <code>gomega.watch/scripts</code> or <code>gomega.watch/schoolgames</code></p>
        </div>
      </div>
    </div>

    <footer>
      <div class="small">Gomega Browser — v14.9.9</div>
      <div class="small">Made by Gomega • <a class="link" href="https://gomega.watch/browser" target="_blank">Check for updates</a></div>
    </footer>
  </div>

  <div class="warningOverlay" id="warn">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="warnTitle">
      <h3 id="warnTitle">External link blocked</h3>
      <p id="warnText">This link points outside <strong>gomega.watch</strong>. To keep users inside Gomega Browser, external pages are blocked. Would you like to open it in your system browser?</p>
      <div class="actions">
        <button id="openExternal" class="btn">Open externally</button>
        <button id="cancelExternal" class="btn" style="background:#2b2f36">Cancel</button>
      </div>
    </div>
  </div>

<script>
(function(){
  const version = "14.9.9";
  document.getElementById('ver').textContent = version;

  const qInput = document.getElementById('q');
  const go = document.getElementById('go');
  const content = document.getElementById('content');
  const pathBar = document.getElementById('pathBar');
  const warn = document.getElementById('warn');
  const openExt = document.getElementById('openExternal');
  const cancelExt = document.getElementById('cancelExternal');
  let pendingExternal = null;

  function isGomegaHost(url){
    try{
      const u = new URL(url, "https://gomega.watch");
      return u.hostname.endsWith("gomega.watch");
    }catch(e){
      return false;
    }
  }

  function showMessage(html){
    content.innerHTML = '<div class="message">'+html+'</div>';
  }

  function loadGomegaPath(path){
    // tidy path
    if(!path){ showMessage("<h3>No query</h3><p class='small'>Type a query or URL in the box above.</p>"); return; }
    // make sure we are targeting gomega.watch
    if(isGomegaHost(path)){
      const url = path.indexOf("http") === 0 ? path : (path.indexOf("gomega.watch")!==-1 ? "https://" + path : "https://gomega.watch/" + path.replace(/^\/+/,''));
      // open the page in a new window inside the app shell; prefer to open in the same window
      // We'll open in a normal location (not iframe) to avoid X-Frame restrictions; when packaged in Electron the main process will handle navigation
      content.innerHTML = '<div class="message"><p class="small">Opening: <strong>' + url + '</strong></p><p style="margin-top:12px">If content does not load, your server may disallow embedding. In the packaged app this loads directly.</p></div>';
      // create a preview link user can click to open in-app or open external:
      const preview = document.createElement('div');
      preview.style.padding = "12px";
      preview.innerHTML = '<a id="openInApp" href="#">Open page in app</a> • <a id="openExtLink" href="#">Open in system browser</a>';
      content.appendChild(preview);

      document.getElementById('openInApp').addEventListener('click', function(e){
        e.preventDefault();
        // In a browser, do a normal navigation (keeps user inside app window). In Electron, this will be intercepted by main process.
        window.location.href = url;
      });

      document.getElementById('openExtLink').addEventListener('click', function(e){
        e.preventDefault();
        // open external in a new tab/window (user will leave the app shell)
        window.open(url, '_blank');
      });

      pathBar.textContent = url;
    } else {
      // treat as a search query (search gomega.watch)
      const q = encodeURIComponent(path);
      const url = "https://gomega.watch/search?q=" + q;
      content.innerHTML = '<div class="message"><p class="small">Searching Gomega for: <strong>' + path + '</strong></p><p style="margin-top:12px">Opening results...</p></div>';
      // Navigate to the search results page in-app (same behavior as openInApp above)
      window.location.href = url;
      pathBar.textContent = "Search results for: " + path;
    }
  }

  go.addEventListener('click', ()=> {
    loadGomegaPath(qInput.value.trim());
  });

  qInput.addEventListener('keydown', function(e){
    if(e.key === 'Enter') {
      e.preventDefault();
      loadGomegaPath(qInput.value.trim());
    }
  });

  // developer simulate outdated button (launches update page)
  document.getElementById('simOut').addEventListener('click', function(){
    if(confirm("Simulate an outdated client? This will open the update page.")){
      window.open("https://gomega.watch/browser", "_blank");
    }
  });

  // external link confirmation handlers
  openExt.addEventListener('click', function(){
    if(pendingExternal){
      // open in external system browser
      window.open(pendingExternal, "_blank");
      hideWarn();
      pendingExternal = null;
    }
  });
  cancelExt.addEventListener('click', function(){ hideWarn(); pendingExternal = null; });

  function showWarn(url){
    pendingExternal = url;
    warn.style.display = "flex";
    document.getElementById('warnText').textContent = "The URL points outside gomega.watch. Open it in your system browser?";
  }
  function hideWarn(){
    warn.style.display = "none";
  }

  // Intercept clicks: if a click would navigate outside gomega.watch and this is not a packaged app, show warning
  document.addEventListener('click', function(e){
    const a = e.target.closest && e.target.closest('a');
    if(!a) return;
    const href = a.getAttribute('href');
    if(!href) return;
    if(href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('javascript:')) return;
    // here we only show a gentle confirmation for non-gomega links
    const targetUrl = (new URL(href, window.location.href)).href;
    if(!isGomegaHost(targetUrl)){
      e.preventDefault();
      showWarn(targetUrl);
    }
  }, true);

  // On load: show helpful example
  showMessage("<h3>Ready</h3><p class='small'>Type a search or path in the box above. Example: <code>gomega.watch/scripts</code> or <code>schoolgames</code></p>");
})();
</script>
</body>
</html>
